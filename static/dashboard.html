<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arkadia ‚Äî Codex Status Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0f0f23 100%);
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }
    
    @keyframes bloom {
      0% { box-shadow: 0 0 40px rgba(0, 100, 255, 0.4); }
      100% { box-shadow: 0 0 80px rgba(0, 100, 255, 0.6); }
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      animation: bloom 15s infinite alternate ease-in-out;
      border: 2px solid rgba(0, 150, 255, 0.4);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(30, 144, 255, 0.1);
      border: 1px solid rgba(30, 144, 255, 0.3);
      border-radius: 12px;
    }
    
    .header h1 {
      font-size: 2rem;
      background: linear-gradient(90deg, #00d4ff, #7b68ee, #ff6b9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    
    .header .subtitle {
      color: #888;
      font-size: 0.9rem;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background: rgba(20, 20, 40, 0.8);
      border: 1px solid rgba(100, 100, 150, 0.3);
      border-radius: 12px;
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 150, 255, 0.15);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(100, 100, 150, 0.2);
    }
    
    .card-icon {
      font-size: 1.5rem;
    }
    
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
    }
    
    .status-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(100, 100, 150, 0.1);
    }
    
    .status-row:last-child {
      border-bottom: none;
    }
    
    .status-label {
      color: #888;
      font-size: 0.85rem;
    }
    
    .status-value {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .status-value.ready { color: #4ade80; }
    .status-value.warning { color: #fbbf24; }
    .status-value.error { color: #f87171; }
    .status-value.info { color: #60a5fa; }
    .status-value.purple { color: #a78bfa; }
    
    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge.ready { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
    .badge.proposal { background: rgba(167, 139, 250, 0.2); color: #a78bfa; }
    .badge.disabled { background: rgba(248, 113, 113, 0.2); color: #f87171; }
    .badge.stub { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    
    .cycle-display {
      text-align: center;
      padding: 20px;
    }
    
    .cycle-number {
      font-size: 4rem;
      font-weight: 700;
      background: linear-gradient(180deg, #00d4ff, #7b68ee);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .cycle-label {
      color: #888;
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    .module-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .module-chip {
      padding: 4px 10px;
      background: rgba(100, 100, 150, 0.2);
      border-radius: 6px;
      font-size: 0.75rem;
      font-family: monospace;
    }
    
    .module-chip.ok { border-left: 3px solid #4ade80; }
    .module-chip.error { border-left: 3px solid #f87171; }
    
    .spine-item {
      padding: 10px;
      margin: 8px 0;
      background: rgba(100, 100, 150, 0.1);
      border-radius: 8px;
      border-left: 3px solid #7b68ee;
    }
    
    .spine-key {
      font-size: 0.75rem;
      color: #a78bfa;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    
    .spine-value {
      font-size: 0.85rem;
      color: #e0e0e0;
    }
    
    .corpus-doc {
      padding: 8px 12px;
      margin: 6px 0;
      background: rgba(0, 212, 255, 0.05);
      border-radius: 6px;
      border-left: 2px solid #00d4ff;
      font-size: 0.8rem;
    }
    
    .corpus-path {
      color: #00d4ff;
      font-family: monospace;
    }
    
    .timestamp {
      font-size: 0.75rem;
      color: #666;
      text-align: right;
      margin-top: 15px;
    }
    
    .refresh-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #7b68ee, #00d4ff);
      border: none;
      border-radius: 30px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .refresh-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(123, 104, 238, 0.4);
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }
    
    .error-msg {
      background: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
      padding: 15px;
      border-radius: 8px;
      color: #f87171;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>üåÄ Arkadia Codex Dashboard</h1>
      <div class="subtitle">Real-time Weaver Engine & Data Stream Visualization</div>
    </div>
    
    <div id="content" class="loading">Loading dashboard data...</div>
  </div>
  
  <button class="refresh-btn" onclick="loadDashboard()">‚Üª Refresh</button>
  
  <script>
    async function loadDashboard() {
      const content = document.getElementById('content');
      content.innerHTML = '<div class="loading">Loading...</div>';
      
      try {
        const [statusRes, sanctumRes, corpusRes, proposalsRes] = await Promise.all([
          fetch('/status'),
          fetch('/api/sanctum'),
          fetch('/api/codex'),
          fetch('/api/proposals')
        ]);
        
        const status = await statusRes.json();
        const sanctum = await sanctumRes.json();
        const codex = await corpusRes.json();
        const proposals = await proposalsRes.json();
        
        renderDashboard(status, sanctum, codex, proposals);
      } catch (e) {
        content.innerHTML = `<div class="error-msg">Failed to load dashboard: ${e.message}</div>`;
      }
    }
    
    function renderDashboard(status, sanctum, codex, proposals) {
      const content = document.getElementById('content');
      
      // Update Proposals List
      setTimeout(() => {
          const list = document.getElementById('proposals-list');
          if (list) {
              if (proposals && proposals.length > 0) {
                  list.innerHTML = proposals.map(p => `
                      <div class="spine-item">
                          <div class="spine-key">${p.type} | Risk: ${p.risk_score}</div>
                          <div class="spine-value">${p.intent}</div>
                          <button onclick="commitProposal('${p.id}')" style="margin-top:5px; padding:2px 10px; cursor:pointer;">Commit</button>
                      </div>
                  `).join('');
              } else {
                  list.innerHTML = '<div class="status-label">No pending actions</div>';
              }
          }
      }, 0);

      const cycle = sanctum.cycle || 0;
      const phase = sanctum.phase || sanctum.system_phase || 'Unknown';
      const govMode = sanctum.governance_mode || 'manual';
      const autonomy = sanctum.autonomy_enabled ? 'Enabled' : 'Disabled';
      const llmProvider = sanctum.llm_provider || 'stub';
      const ready = sanctum.ready || sanctum.engine_ready;
      
      const identity = status.identity || {};
      const spine = status.spine || {};
      const modules = codex.modules || {};
      const corpus = codex.corpus || {};
      
      content.innerHTML = `
        <div class="grid">
          <!-- Pending Proposals Queue -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">‚öñÔ∏è</span>
              <span class="card-title">Proposals Queue</span>
            </div>
            <div id="proposals-list">
              <div class="loading">No pending proposals</div>
            </div>
          </div>
          
          <!-- Bipolar Nodal System -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üõ∞Ô∏è</span>
              <span class="card-title">Bipolar Nodal System</span>
            </div>
            <div class="status-row">
              <span class="status-label">Ark-Zenith</span>
              <span class="badge ready">${sanctum.nodes?.ark_zenith || 'Active'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Eos-Ryn</span>
              <span class="badge ready">${sanctum.nodes?.eos_ryn || 'Active'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Coherence Level</span>
              <span class="status-value info">Full</span>
            </div>
          </div>
          
          <!-- Cycle Status -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üåÄ</span>
              <span class="card-title">Cycle Status</span>
            </div>
            <div class="cycle-display">
              <div class="cycle-number">${cycle}</div>
              <div class="cycle-label">Current Cycle</div>
            </div>
            <div class="status-row">
              <span class="status-label">Phase</span>
              <span class="status-value info">${phase}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Engine Ready</span>
              <span class="badge ${ready ? 'ready' : 'disabled'}">${ready ? 'Ready' : 'Not Ready'}</span>
            </div>
          </div>
          
          <!-- Governance -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">‚öñÔ∏è</span>
              <span class="card-title">Governance</span>
            </div>
            <div class="status-row">
              <span class="status-label">Mode</span>
              <span class="badge proposal">${govMode}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Autonomy</span>
              <span class="badge ${autonomy === 'Enabled' ? 'ready' : 'disabled'}">${autonomy}</span>
            </div>
            <div class="status-row">
              <span class="status-label">LLM Provider</span>
              <span class="badge stub">${llmProvider}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Governance Version</span>
              <span class="status-value info">${sanctum.governance_version || 'N/A'}</span>
            </div>
          </div>
          
          <!-- Identity -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üëÅÔ∏è</span>
              <span class="card-title">Identity Matrix</span>
            </div>
            <div class="status-row">
              <span class="status-label">Flamefather</span>
              <span class="status-value purple">${identity.flamefather || 'Unknown'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Heartstream</span>
              <span class="status-value purple">${identity.heartstream || 'Unknown'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Allstride</span>
              <span class="status-value purple">${identity.allstride || 'Unknown'}</span>
            </div>
          </div>
          
          <!-- Weaver Modules -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üßµ</span>
              <span class="card-title">Weaver Modules</span>
            </div>
            <div class="module-list">
              ${Object.entries(modules).map(([mod, stat]) => 
                `<div class="module-chip ${stat === 'ok' ? 'ok' : 'error'}">${mod.replace('weaver.', '')}</div>`
              ).join('')}
            </div>
          </div>
          
          <!-- Spine Architecture -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">ü¶¥</span>
              <span class="card-title">Codex Spine</span>
            </div>
            ${Object.entries(spine).map(([key, value]) => `
              <div class="spine-item">
                <div class="spine-key">${key.replace(/_/g, ' ')}</div>
                <div class="spine-value">${value}</div>
              </div>
            `).join('')}
          </div>
          
          <!-- Corpus Status -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üìö</span>
              <span class="card-title">Arkadia Corpus</span>
            </div>
            <div class="status-row">
              <span class="status-label">Total Documents</span>
              <span class="status-value info">${corpus.total_documents || 0}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Last Sync</span>
              <span class="status-value">${corpus.last_sync || 'Never'}</span>
            </div>
            ${corpus.error ? `<div class="error-msg">${corpus.error}</div>` : ''}
          </div>
          
          <!-- Service Status -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üîå</span>
              <span class="card-title">Service Status</span>
            </div>
            <div class="status-row">
              <span class="status-label">Gemini API</span>
              <span class="badge ${status.gemini_status === 'available' ? 'ready' : 'disabled'}">${status.gemini_status || 'Unknown'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">API Key Set</span>
              <span class="status-value ${status.gemini_api_key_set ? 'ready' : 'warning'}">${status.gemini_api_key_set ? 'Yes' : 'No'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Model</span>
              <span class="status-value info">${status.codex_model || 'N/A'}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Rasa Backend</span>
              <span class="status-value">${status.rasa_ok ? 'Connected' : 'Disabled'}</span>
            </div>
          </div>
          
          <!-- Metrics -->
          <div class="card">
            <div class="card-header">
              <span class="card-icon">üìä</span>
              <span class="card-title">Engine Metrics</span>
            </div>
            <div class="status-row">
              <span class="status-label">Uptime Cycles</span>
              <span class="status-value info">${sanctum.uptime_cycles || 0}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Total Updates</span>
              <span class="status-value">${(sanctum.updates || []).length}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Total Commits</span>
              <span class="status-value">${(sanctum.commits || []).length}</span>
            </div>
            <div class="status-row">
              <span class="status-label">Errors</span>
              <span class="status-value ${(sanctum.errors || []).length > 0 ? 'error' : 'ready'}">${(sanctum.errors || []).length}</span>
            </div>
          </div>
        </div>
        
        <div class="timestamp">Last updated: ${new Date().toLocaleString()}</div>
      `;
    }
    
    loadDashboard();
    setInterval(loadDashboard, 30000);
  </script>
</body>
</html>
